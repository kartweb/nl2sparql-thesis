import unittest
from SPARQLWrapper import SPARQLWrapper, JSON

class TestRAG(unittest.TestCase):
    def setUp(self):
        self.endpoint = "http://localhost:9999/blazegraph/sparql"
        self.sparql = SPARQLWrapper(self.endpoint)
        self.sparql.setReturnFormat(JSON)
    
    def test_simple_query(self):
        token = "diabetes"
        query = f"""
        SELECT ?s ?p ?o WHERE {{
            GRAPH <https://w3id.org/CDIO/graph/studies> {{
                ?s ?p ?o .
                FILTER(
                    CONTAINS( LCASE( STR(?s) ), LCASE("{token}") ) ||
                    CONTAINS( LCASE( STR(?p) ), LCASE("{token}") ) ||
                    CONTAINS( LCASE( STR(?o) ), LCASE("{token}"))
                )
            }}
        }} 
        LIMIT 5
        """
        self.sparql.setQuery(query)
        results = self.sparql.queryAndConvert()
        self.assertIsInstance(results, dict)
        self.assertIn("results", results)
        self.assertIn("bindings",results["results"])
        print("Sample results:", results["results"]["bindings"][:2])

if __name__ == "__main__":
    unittest.main(verbosity=2) # python default entry point for running unit tests